+++
title = "gpu.js電界シミュレータ"
date = 2023-02-28
[taxonomies]
categories = ["tech"]
tags = ["javascript", "github-pages"]
links = ["https://natsuka-sili.github.io/werve-gpujs/"]
+++

# 心意気
研究室で以前つくられた電界シミュレータをweb上で実装し卒業研究にしようという心意気で作りました｡作っているうちに知ったのですが他の年度にも色々と試されていたようで陳腐な卒研となりましたが自己満足しているのも事実です｡

# 作ったもの
<https://natsuka-sili.github.io/werve-gpujs/>
## 機能
白い範囲をクリックすると赤い円と無数の矢印が見えるかと思います｡赤は正を円は電荷を示し赤い円は正電荷で矢印は電界です｡右下にchargeとあるスライダーを左に動かし白い範囲をクリックすると円の大きさが違う青い円が現れ動き出すかと思います｡青は負で大きさは電荷の大きさを示しており青い円は負電荷です｡精密なシミュレータではありませんが電荷や電界の動きは習ったそれと変わらないのではないでしょうか｡これが基本で8つあるスイッチは細かい設定の為にありますから簡単に紹介していきます｡

| time | : | 時間を再生/停止します |
| -: | | |
| norm | : | 電界の大きさを輝度で表します |
| vector | : | 電界のベクトルを矢印で表します |
| install | : | クリックするとchargeに合う値の電荷を置きます |
| delete | : | 電荷をクリックすると消すことができます |
| fix | : | 電荷をクリックすると固定できます |
| move | : | 電荷をドラッグアンドドロップで移動させられます |

## ソースコード
<https://github.com/natsuka-sili/werve-gpujs>

基本的に`src`内の`.js`ファイルを読んでもらえばシミュレーションについてわかるかと思います｡

# 処理
1. 1つの電荷に対する電界の値を599×599で計算しテンプレートに格納する
1. 電荷の位置を元に電界のテンプレートを動かし配列300×300に格納する
1. 電荷の数だけ総和して配列300×300に格納していく
1. 電荷の座標に対応する電界配列の要素を電荷値と乗算してクーロン力を計算する
1. クーロン力を元に位置と速度と加速度を計算する
1. 表示する

これの2.から6.を繰り返していると思ってください｡配列の大きさ300×300は色々と試して処理速度と分解能を設定したので最適とかではありません｡

## gpu.js
[gpu.js](https://gpu.rocks/#/)は1.から3.及び6.で使っています｡`new GPU({ mode: 'cpu' });`でgpuを使わない手法も取れると[ドキュメント](https://github.com/gpujs/gpu.js)には書いてあるのですが機能せずcpuとの比較が出来ていませんからgpuのありがたみも未知数となります｡

## canvas
[gpu.js](https://gpu.rocks/#/)を6.で使っているのも事実なのですが半分くらいです｡normでの電界の輝度表示は[gpu.js](https://gpu.rocks/#/)を用いているのですがvectorで使える電界のベクトル表示や電荷の円は[javascript](https://developer.mozilla.org/ja/docs/Web/JavaScript)で描いています｡300×300でいくつも矢印を描くと見てられないので300×300で出た輝度表示は600×600に補間せず拡大しベクトル表示の方は600×600で出しています｡

## ダークモード
ちょうど流行りだったので作りました｡[gpu.js](https://gpu.rocks/#/)の輝度表示は白黒反転させず表示のための配列への格納の時点で色を変えています｡

# デプロイ
[webpack](https://webpack.js.org/)を用いてローカルで生成したものを[github pages](https://docs.github.com/ja/pages/getting-started-with-github-pages/about-github-pages)で`/docs`のデプロイしています｡当初は[bitbucket](https://bitbucket.org/)を使っていたので[heroku](https://jp.heroku.com/)を使おうとしていたのですが何故かうまくいきませんでした｡最近の[heroku](https://jp.heroku.com/)を見ている感じ災い転じて福となすというやつですね｡